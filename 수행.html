<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>í´ë˜ìŠ¤ ì˜¨ - í•™ê¸‰ ê³µì§€ & ìˆ˜í–‰í‰ê°€</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 600px;
      margin: 40px auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    header {
      text-align: center;
      margin-bottom: 30px;
    }

    header h1 {
      color: #007bff;
      margin: 0;
    }

    .form-group {
      margin-bottom: 20px;
    }

    input, textarea {
      padding: 10px;
      width: 100%;
      box-sizing: border-box;
      margin-top: 5px;
      margin-bottom: 10px;
    }

    button {
      padding: 10px 15px;
      border: none;
      background-color: #007bff;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }

    #app {
      display: none;
    }

    .editor-only {
      display: none;
      margin-top: 20px;
    }

    #noticeList {
      background: #eef;
      padding: 10px;
      border-radius: 5px;
    }

    .notice-item {
      padding: 10px 0;
      border-bottom: 1px solid #ddd;
    }

    .notice-item:last-child {
      border-bottom: none;
    }

    .notice-item img {
      max-width: 100%;
      margin-top: 10px;
      border-radius: 8px;
    }

    .footer {
      text-align: center;
      font-size: 12px;
      color: gray;
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ“š í´ë˜ìŠ¤ ì˜¨</h1>
      <p>ìš°ë¦¬ ë°˜ ê³µì§€ì‚¬í•­ê³¼ ìˆ˜í–‰í‰ê°€ë¥¼ í•œëˆˆì—!</p>
    </header>

    <section id="loginSection">
      <h3>ğŸ” ë¡œê·¸ì¸</h3>
      <div class="form-group">
        <input type="text" id="loginId" placeholder="ì•„ì´ë”” ì…ë ¥">
        <input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
        <button onclick="login()">ë¡œê·¸ì¸</button>
      </div>
    </section>

    <section id="app">
      <h3 id="welcome"></h3>

      <div class="editor-only">
        <h4>ğŸ“¢ ìƒˆ ê³µì§€ ë“±ë¡</h4>
        <input type="text" id="noticeTitle" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
        <input type="date" id="performanceDate" placeholder="ìˆ˜í–‰ì¼ì ì…ë ¥">
        <textarea id="noticeContent" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        <input type="file" id="noticeImage" accept="image/*">
        <button onclick="postNotice()">ê³µì§€ ë“±ë¡</button>
      </div>

      <h4>ğŸ“„ ê³µì§€ì‚¬í•­</h4>
      <div id="noticeList">ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
    </section>

    <div class="footer">
      â“’ 2025 í´ë˜ìŠ¤ ì˜¨ | ë§Œë“ ì´: ì†¡ë¯¼ì¤€
    </div>
  </div>

  <script>
    // âœ… Supabase ì—°ê²°: ë³€ìˆ˜ëª… ì¶©ëŒ í•´ê²°
    const supabaseClient = supabase.createClient(
      'https://gkeujimtvzioehhgmovz.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdrZXVqaW10dnppb2VoaGdtb3Z6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyNDU5MzMsImV4cCI6MjA2MzgyMTkzM30.YPP-TaJQk9XSbIyKib0GUQeR1wwDpqfJIcHKdKz2YCQ'
    );

    const users = [
    { id: "ê³½í˜¸ì£¼", name: "ê³½í˜¸ì£¼", password: "bd1234", is_editor: false },
    { id: "ê¶Œë¯¼ì„œ", name: "ê¶Œë¯¼ì„œ", password: "bd1234", is_editor: false },
    { id: "ê¹€ê°€ì˜¨", name: "ê¹€ê°€ì˜¨", password: "bd1234", is_editor: false },
    { id: "ê¹€ë„í¬", name: "ê¹€ë„í¬", password: "bd1234", is_editor: false },
    { id: "ê¹€ë³´ì„œ", name: "ê¹€ë³´ì„œ", password: "bd1234", is_editor: true },
    { id: "ê¹€ì†Œìœ¤", name: "ê¹€ì†Œìœ¤", password: "bd1234", is_editor: true },
    { id: "ê¹€ì‹œì˜¨", name: "ê¹€ì‹œì˜¨", password: "bd1234", is_editor: false },
    { id: "ê¹€ì‹œìœ¤", name: "ê¹€ì‹œìœ¤", password: "bd1234", is_editor: false },
    { id: "ê¹€ìœ ë¦¼", name: "ê¹€ìœ ë¦¼", password: "bd1234", is_editor: false },
    { id: "ê¹€ì°¬ì˜", name: "ê¹€ì°¬ì˜", password: "bd1234", is_editor: false },
    { id: "ê¹€í•˜ì€", name: "ê¹€í•˜ì€", password: "bd1234", is_editor: false },
    { id: "ê¹€í•˜ì¤€", name: "ê¹€í•˜ì¤€", password: "bd1234", is_editor: false },
    { id: "ê¹€ë‹¨ë¹„", name: "ê¹€ë‹¨ë¹„", password: "bd1234", is_editor: false },
    { id: "ê¹€ë˜ì›", name: "ê¹€ë˜ì›", password: "bd1234", is_editor: true },
    { id: "ëª©ì†Œìœ¤", name: "ëª©ì†Œìœ¤", password: "bd1234", is_editor: true },
    { id: "ì„œì§€íš¨", name: "ì„œì§€íš¨", password: "bd1234", is_editor: false },
    { id: "ì†ì§€ë¯¼", name: "ì†ì§€ë¯¼", password: "bd1234", is_editor: false },
    { id: "ì†¡ë¯¼ì¤€", name: "ì†¡ë¯¼ì¤€", password: "bd1234", is_editor: true },
    { id: "ì†¡ì˜ˆì¤€", name: "ì†¡ì˜ˆì¤€", password: "bd1234", is_editor: false },
    { id: "ì†¡í•˜ìœ¤", name: "ì†¡í•˜ìœ¤", password: "bd1234", is_editor: false },
    { id: "ì‹ ì±„ìœ¤", name: "ì‹ ì±„ìœ¤", password: "bd1234", is_editor: false },
    { id: "ì–‘í˜„ì§„", name: "ì–‘í˜„ì§„", password: "bd1234", is_editor: false },
    { id: "ì´ìŠ¹ë¯¼", name: "ì´ìŠ¹ë¯¼", password: "bd1234", is_editor: false },
    { id: "ì´ì˜ì¤€", name: "ì´ì˜ì¤€", password: "bd1234", is_editor: false },
    { id: "ì´ì¬ì¸", name: "ì´ì¬ì¸", password: "bd1234", is_editor: false },
    { id: "ì´í•œê²°", name: "ì´í•œê²°", password: "bd1234", is_editor: false },
    { id: "ì´íš¨ì¸", name: "ì´íš¨ì¸", password: "bd1234", is_editor: false },
    { id: "ì„íš¨ìƒ", name: "ì„íš¨ìƒ", password: "bd1234", is_editor: false },
    { id: "ì£¼ì‹œí•˜", name: "ì£¼ì‹œí•˜", password: "bd1234", is_editor: false },
    { id: "ì£¼í˜„ì„±", name: "ì£¼í˜„ì„±", password: "bd1234", is_editor: false },
    { id: "ìµœê°€ëŒ", name: "ìµœê°€ëŒ", password: "bd1234", is_editor: false },
    { id: "í™ì°¬ìŠ¬", name: "í™ì°¬ìŠ¬", password: "bd1234", is_editor: false },
    { id: "í•œì¸í‘œ", name: "í•œì¸í‘œ", password: "bd1234", is_editor: false },
    { id: "ì„ ìƒë‹˜", name: "ì„ ìƒë‹˜", password: "bd1234", is_editor: true },
    ];


    let currentUser = null;

    function login() {
      const id = document.getElementById("loginId").value;
      const pw = document.getElementById("loginPw").value;
      const user = users.find(u => u.id === id && u.password === pw);

      if (user) {
        currentUser = user;
        document.getElementById("welcome").textContent = `ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”, ${user.name}ë‹˜`;
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("app").style.display = "block";
        if (user.is_editor) {
          document.querySelector(".editor-only").style.display = "block";
        }
        loadNotices();
      } else {
        alert("âŒ ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
      }
    }

    async function uploadImage(file) {
      const fileName = `${Date.now()}_${file.name}`;
      const { data, error } = await supabaseClient.storage
        .from('notice-images')
        .upload(fileName, file);

      if (error) {
        console.error(error);
        throw new Error("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨");
      }

      return `https://gkeujimtvzioehhgmovz.supabase.co/storage/v1/object/public/notice-images/${fileName}`;
    }

    async function postNotice() {
      const title = document.getElementById("noticeTitle").value.trim();
      const content = document.getElementById("noticeContent").value.trim();
      const date = document.getElementById("noticeDate").value;
      const imageFile = document.getElementById("noticeImage").files[0];

      if (!title || !content || !date) {
        alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
        return;
      }

      let imageUrl = '';
      if (imageFile) {
        try {
          imageUrl = await uploadImage(imageFile);
        } catch {
          return alert("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      const performanceDate = document.getElementById("performanceDate").value;

    const { error } = await supabaseClient.from('notices').insert({
    title,
    content,
    performance_date: performanceDate,
    image_url: imageUrl,
    created_by: currentUser.name
    });


      if (error) {
        alert("ê³µì§€ ë“±ë¡ ì‹¤íŒ¨");
        console.error(error);
      } else {
        alert("ê³µì§€ ë“±ë¡ ì™„ë£Œ!");
        document.getElementById("noticeTitle").value = "";
        document.getElementById("noticeContent").value = "";
        document.getElementById("noticeDate").value = "";
        document.getElementById("noticeImage").value = "";
        loadNotices();
      }
    }

    async function loadNotices() {
    const { data, error } = await supabaseClient
        .from('notices')
        .select('*')
        .order('performance_date', { ascending: true });  // â† âœ… ìˆ˜í–‰ì¼ ê¸°ì¤€ ì •ë ¬

    const container = document.getElementById("noticeList");

    if (error || !data) {
        container.innerHTML = "ê³µì§€ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
        return;
    }

    if (data.length === 0) {
        container.innerHTML = "ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.";
        return;
    }

    container.innerHTML = data.map(n => `
        <div class="notice-item">
        <strong>${n.title}</strong> (ğŸ—“ï¸ ìˆ˜í–‰ì¼: ${n.performance_date})<br/>
        ${n.content}<br/>
        <small>ì‘ì„±ì: ${n.created_by}</small><br/>
        ${n.image_url ? `<img src="${n.image_url}" alt="ì´ë¯¸ì§€">` : ''}
        </div>
    `).join('');
    }

  </script>
</body>
</html>
