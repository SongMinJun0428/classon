<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í´ë˜ìŠ¤ ì˜¨ - í•™ê¸‰ ê³µì§€ & ìˆ˜í–‰í‰ê°€</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
  body {
  font-family: 'Arial', sans-serif;
  background-color: #f4f4f4;
  margin: 0;
  padding: 0;
}

.container {
  width: 92%;
  max-width: 600px;
  margin: 20px auto;
  background: white;
  padding: 24px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

header {
  text-align: center;
  margin-bottom: 20px;
}

header h1 {
  color: #007bff;
  margin: 0;
  font-size: 1.8rem;
}

.form-group {
  margin-bottom: 16px;
}

input, textarea {
  padding: 12px;
  width: 100%;
  font-size: 1rem;
  box-sizing: border-box;
  margin-top: 6px;
  margin-bottom: 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
}

textarea {
  resize: vertical;
  min-height: 90px;
}

button {
  padding: 12px;
  width: 100%;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 1rem;
  cursor: pointer;
  margin-bottom: 12px;
}

button:hover {
  background-color: #0056b3;
}

#app {
  display: none;
}

.editor-only {
  display: none;
  margin-top: 24px;
}

#noticeForm {
  margin-top: 10px;
}

#noticeList {
  background: #eef;
  padding: 12px;
  border-radius: 6px;
}

.notice-item {
  padding: 14px 0;
  border-bottom: 1px solid #ddd;
  word-break: break-word;
}

.notice-item:last-child {
  border-bottom: none;
}

.notice-item img {
  width: 100%;
  height: auto;
  margin-top: 10px;
  margin-bottom: 8px;
  border-radius: 8px;
}

.notice-item a {
  display: inline-block;
  margin-top: 6px;
  font-size: 0.95rem;
  color: #007bff;
  text-decoration: none;
}

.notice-item a:hover {
  text-decoration: underline;
}

.footer {
  text-align: center;
  font-size: 12px;
  color: gray;
  margin-top: 30px;
}

/* âœ… ëª¨ë°”ì¼ ëŒ€ì‘ */
@media screen and (max-width: 480px) {
  header h1 {
    font-size: 1.5rem;
  }

  input, textarea, button {
    font-size: 1rem;
    padding: 10px;
  }

  .container {
    padding: 18px;
  }

  .notice-item {
    font-size: 0.95rem;
  }

  .footer {
    font-size: 11px;
  }
}

/* ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë“œ ìŠ¤íƒ€ì¼ */
.image-slider {
  display: flex;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  gap: 10px;
  padding: 10px 0;
  -webkit-overflow-scrolling: touch;
}

.image-slider::-webkit-scrollbar {
  display: none;
}

.slide-item {
  flex-shrink: 0;
  width: 100%;
  max-width: 300px;
  scroll-snap-align: start;
  text-align: center;
  display: none;
}

.slide-item.active {
  display: block;
}

.slide-item img {
  width: 100%;
  height: auto;
  border-radius: 8px;
}

.download-link {
  display: block;
  margin-top: 6px;
  font-size: 0.9rem;
  color: #007bff;
  text-decoration: none;
}

.slider-wrapper {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin-top: 10px;
}

.slider-wrapper .prev-btn,
.slider-wrapper .next-btn {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: #007bff;
}

.slide-container {
  width: 100%;
  max-width: 300px;
  overflow: hidden;
}



/* ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë“œ ìŠ¤íƒ€ì¼ */
.image-slider {
  display: flex;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  gap: 10px;
  padding: 10px 0;
  -webkit-overflow-scrolling: touch;
}

.image-slider::-webkit-scrollbar {
  display: none;
}

.slide-item {
  flex-shrink: 0;
  width: 100%;
  max-width: 300px;
  scroll-snap-align: start;
  text-align: center;
}

.slide-item img {
  width: 100%;
  height: auto;
  border-radius: 8px;
}

.download-link {
  display: block;
  margin-top: 6px;
  font-size: 0.9rem;
  color: #007bff;
  text-decoration: none;
}


</style>


</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ“š í´ë˜ìŠ¤ ì˜¨</h1>
      <p>ìš°ë¦¬ ë°˜ ê³µì§€ì‚¬í•­ê³¼ ìˆ˜í–‰í‰ê°€ë¥¼ í•œëˆˆì—!</p>
    </header>

    <section id="loginSection">
      <h3>ğŸ” ë¡œê·¸ì¸</h3>
      <div class="form-group">
        <input type="text" id="loginId" placeholder="ì•„ì´ë”” ì…ë ¥">
        <input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
        <button onclick="login()">ë¡œê·¸ì¸</button>
      </div>
    </section>

    <section id="app">
      <h3 id="welcome"></h3>

      <div class="editor-only">
        <h4>ğŸ“¢ ìƒˆ ê³µì§€ ë“±ë¡</h4>
        <input type="text" id="noticeTitle" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
        <input type="date" id="performanceDate" placeholder="ìˆ˜í–‰ì¼ì ì…ë ¥">
        <textarea id="noticeContent" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        <input type="file" id="noticeImage" accept="image/*" multiple>
        <button onclick="postNotice()">ê³µì§€ ë“±ë¡</button>
      </div>

      <h4>ğŸ“„ ê³µì§€ì‚¬í•­</h4>
      <div id="noticeList">ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
    </section>

    <div class="footer">
      â“’ 2025 í´ë˜ìŠ¤ ì˜¨ | ë§Œë“ ì´: ì†¡ë¯¼ì¤€
    </div>
  </div>

  <script>
    // âœ… Supabase ì—°ê²°: ë³€ìˆ˜ëª… ì¶©ëŒ í•´ê²°
    const supabaseClient = supabase.createClient(
      'https://gkeujimtvzioehhgmovz.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdrZXVqaW10dnppb2VoaGdtb3Z6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyNDU5MzMsImV4cCI6MjA2MzgyMTkzM30.YPP-TaJQk9XSbIyKib0GUQeR1wwDpqfJIcHKdKz2YCQ'
    );

    const users = [
    { id: "ê³½í˜¸ì£¼", name: "ê³½í˜¸ì£¼", password: "bd1234", is_editor: false },
    { id: "ê¶Œë¯¼ì„œ", name: "ê¶Œë¯¼ì„œ", password: "bd1234", is_editor: false },
    { id: "ê¹€ê°€ì˜¨", name: "ê¹€ê°€ì˜¨", password: "bd1234", is_editor: false },
    { id: "ê¹€ë„í¬", name: "ê¹€ë„í¬", password: "bd1234", is_editor: false },
    { id: "ê¹€ë³´ì„œ", name: "ê¹€ë³´ì„œ", password: "bd1234", is_editor: true },
    { id: "ê¹€ì†Œìœ¤", name: "ê¹€ì†Œìœ¤", password: "bd1234", is_editor: true },
    { id: "ê¹€ì‹œì˜¨", name: "ê¹€ì‹œì˜¨", password: "bd1234", is_editor: false },
    { id: "ê¹€ì‹œìœ¤", name: "ê¹€ì‹œìœ¤", password: "bd1234", is_editor: false },
    { id: "ê¹€ìœ ë¦¼", name: "ê¹€ìœ ë¦¼", password: "bd1234", is_editor: false },
    { id: "ê¹€ì°¬ì˜", name: "ê¹€ì°¬ì˜", password: "bd1234", is_editor: false },
    { id: "ê¹€í•˜ì€", name: "ê¹€í•˜ì€", password: "bd1234", is_editor: false },
    { id: "ê¹€í•˜ì¤€", name: "ê¹€í•˜ì¤€", password: "bd1234", is_editor: false },
    { id: "ê¹€ë‹¨ë¹„", name: "ê¹€ë‹¨ë¹„", password: "bd1234", is_editor: false },
    { id: "ê¹€ë˜ì›", name: "ê¹€ë˜ì›", password: "bd1234", is_editor: true },
    { id: "ëª©ì†Œìœ¤", name: "ëª©ì†Œìœ¤", password: "bd1234", is_editor: true },
    { id: "ì„œì§€íš¨", name: "ì„œì§€íš¨", password: "bd1234", is_editor: false },
    { id: "ì†ì§€ë¯¼", name: "ì†ì§€ë¯¼", password: "bd1234", is_editor: false },
    { id: "ì†¡ë¯¼ì¤€", name: "ì†¡ë¯¼ì¤€", password: "bd20318", is_editor: true },
    { id: "ì†¡ì˜ˆì¤€", name: "ì†¡ì˜ˆì¤€", password: "bd1234", is_editor: false },
    { id: "ì†¡í•˜ìœ¤", name: "ì†¡í•˜ìœ¤", password: "bd1234", is_editor: false },
    { id: "ì‹ ì±„ìœ¤", name: "ì‹ ì±„ìœ¤", password: "bd1234", is_editor: false },
    { id: "ì–‘í˜„ì§„", name: "ì–‘í˜„ì§„", password: "bd1234", is_editor: false },
    { id: "ì´ìŠ¹ë¯¼", name: "ì´ìŠ¹ë¯¼", password: "bd1234", is_editor: false },
    { id: "ì´ì˜ì¤€", name: "ì´ì˜ì¤€", password: "bd1234", is_editor: false },
    { id: "ì´ì¬ì¸", name: "ì´ì¬ì¸", password: "bd1234", is_editor: false },
    { id: "ì´í•œê²°", name: "ì´í•œê²°", password: "bd1234", is_editor: false },
    { id: "ì´íš¨ì¸", name: "ì´íš¨ì¸", password: "bd1234", is_editor: false },
    { id: "ì„íš¨ìƒ", name: "ì„íš¨ìƒ", password: "bd1234", is_editor: false },
    { id: "ì£¼ì‹œí•˜", name: "ì£¼ì‹œí•˜", password: "bd1234", is_editor: false },
    { id: "ì£¼í˜„ì„±", name: "ì£¼í˜„ì„±", password: "bd1234", is_editor: false },
    { id: "ìµœê°€ëŒ", name: "ìµœê°€ëŒ", password: "bd1234", is_editor: false },
    { id: "í™ì°¬ìŠ¬", name: "í™ì°¬ìŠ¬", password: "bd1234", is_editor: false },
    { id: "í•œì¸í‘œ", name: "í•œì¸í‘œ", password: "bd1234", is_editor: false },
    { id: "ì„ ìƒë‹˜", name: "ì„ ìƒë‹˜", password: "bd1234", is_editor: true },
    ];


    let currentUser = null;

    async function login() {
  const id = document.getElementById("loginId").value;
  const pw = document.getElementById("loginPw").value;
  const user = users.find(u => u.id === id && u.password === pw);

  if (user) {
    currentUser = user;

    // UI ì—…ë°ì´íŠ¸
    document.getElementById("welcome").textContent = `ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”, ${user.name}ë‹˜`;
    document.getElementById("loginSection").style.display = "none";
    document.getElementById("app").style.display = "block";

    // ì‘ì„± ê¶Œí•œì´ ìˆì„ ê²½ìš°ë§Œ ì…ë ¥ ì˜ì—­ ë³´ì´ê¸°
    if (user.is_editor) {
      document.querySelector(".editor-only").style.display = "block";
    }

    // âœ… Supabaseì— ë¡œê·¸ì¸ ê¸°ë¡ ì €ì¥
    const { error: logError } = await supabaseClient.from("logins").insert({
      user_id: user.id,
      name: user.name
    });

    if (logError) {
      console.error("ğŸš¨ ë¡œê·¸ì¸ ê¸°ë¡ ì €ì¥ ì‹¤íŒ¨:", logError.message || logError);
    }

    // ê³µì§€ ë¶ˆëŸ¬ì˜¤ê¸°
    loadNotices();


  } else {
    alert("âŒ ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
  }
}


    function sanitizeFileName(originalName) {
  const extension = originalName.substring(originalName.lastIndexOf('.'));
  const base = Date.now() + '_' + Math.random().toString(36).substring(2, 8);
  return `${base}${extension}`;
}


    async function uploadImage(file) {
  const safeFileName = sanitizeFileName(file.name); // ğŸ‘ˆ ì•ˆì „í•œ íŒŒì¼ëª… ë§Œë“¤ê¸°

  const { error } = await supabaseClient.storage
    .from('notice-images')
    .upload(safeFileName, file);

  if (error) {
    console.error("ğŸš¨ ì—…ë¡œë“œ ì‹¤íŒ¨:", error.message || error);
    throw new Error("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨");
  }

  return `https://gkeujimtvzioehhgmovz.supabase.co/storage/v1/object/public/notice-images/${safeFileName}`;
}



async function loadNotices() {
  const { data, error } = await supabaseClient
    .from('notices')
    .select('*')
    .order('performance_date', { ascending: true });

  const container = document.getElementById("noticeList");

  if (error || !data) {
    container.innerHTML = "ê³µì§€ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
    return;
  }

  if (data.length === 0) {
    container.innerHTML = "ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.";
    return;
  }

  container.innerHTML = data.map(n => {
  let imagesHTML = "";

  if (Array.isArray(n.image_url)) {
  const urls = n.image_url;

  if (urls.length >= 2) {
    const sliderId = `slider-${n.id || Math.random().toString(36).substr(2, 5)}`;
    imagesHTML = `
      <div class="slider-wrapper" id="${sliderId}">
        <button class="prev-btn" onclick="prevSlide('${sliderId}')">â—€</button>
        <div class="slide-container">
          ${urls.map((url, i) => `
            <div class="slide-item ${i === 0 ? 'active' : ''}">
              <img src="${url}" />
              <a href="${url}" download="${getFileNameFromUrl(url)}" class="download-link">ğŸ“¥ ì´ë¯¸ì§€ ì €ì¥</a>
            </div>
          `).join('')}
        </div>
        <button class="next-btn" onclick="nextSlide('${sliderId}')">â–¶</button>
      </div>
    `;
  } else if (urls.length === 1 && urls[0]) {
    const url = urls[0];
    imagesHTML = `
      <div class="slide-item active" style="text-align: center;">
        <img src="${url}" />
        <a href="${url}" download="${getFileNameFromUrl(url)}" class="download-link">ğŸ“¥ ì´ë¯¸ì§€ ì €ì¥</a>
      </div>
    `;
  }
}


  return `
    <div class="notice-item">
      <strong>${n.title}</strong> (ğŸ—“ï¸ ìˆ˜í–‰ì¼: ${n.performance_date})<br/>
      ${n.content}<br/>
      <small>ì‘ì„±ì: ${n.created_by}</small>
      ${imagesHTML}
    </div>
  `;
}).join('');
}

    function getFileNameFromUrl(url) {
  return url.split('/').pop().split('?')[0];
}


    async function postNotice() {
  const title = document.getElementById("noticeTitle").value.trim();
  const content = document.getElementById("noticeContent").value.trim();
  const performanceDate = document.getElementById("performanceDate").value;
  const imageFiles = document.getElementById("noticeImage").files;

  if (!title || !content || !performanceDate) {
    alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
    return;
  }

  let imageUrls = [];

  if (imageFiles.length > 0) {
    for (let i = 0; i < imageFiles.length; i++) {
      try {
        const url = await uploadImage(imageFiles[i]);
        imageUrls.push(url);
      } catch {
        return alert("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    }
  }

  const { error } = await supabaseClient.from('notices').insert({
    title,
    content,
    performance_date: performanceDate,
    image_url: imageUrls,
    created_by: currentUser.name
  });

  if (error) {
    alert("ê³µì§€ ë“±ë¡ ì‹¤íŒ¨");
    console.error(error);
  } else {
    alert("ê³µì§€ ë“±ë¡ ì™„ë£Œ!");
    document.getElementById("noticeTitle").value = "";
    document.getElementById("noticeContent").value = "";
    document.getElementById("performanceDate").value = "";
    document.getElementById("noticeImage").value = "";
    loadNotices();
  }
}


function nextSlide(wrapperId) {
  const container = document.querySelector(`#${wrapperId} .slide-container`);
  const slides = container.querySelectorAll('.slide-item');
  let current = Array.from(slides).findIndex(s => s.classList.contains('active'));
  slides[current].classList.remove('active');
  slides[(current + 1) % slides.length].classList.add('active');
}

function prevSlide(wrapperId) {
  const container = document.querySelector(`#${wrapperId} .slide-container`);
  const slides = container.querySelectorAll('.slide-item');
  let current = Array.from(slides).findIndex(s => s.classList.contains('active'));
  slides[current].classList.remove('active');
  slides[(current - 1 + slides.length) % slides.length].classList.add('active');
}


  </script>
</body>
</html>